function ContextMenuModule(window, document) {

var HeaderHeight = 30
var Padding = 2
var DarkBackground = "#455A64"

var gList = null
var gMain = null

// Autogenerated with DRAKON Editor 1.32


function addCell(tr, item) {
    // item 131
    var size = 40
    var img
    // item 101
    var td = make(tr, "td")
    // item 133
    if (item.draw) {
        // item 136
        img = make(td, "canvas")
        // item 137
        item.draw(img, size, size)
    } else {
        // item 104
        img = make(td, "img")
        // item 132
        img.src = makeImagePath(item.image)
        img.width = size
        img.height = size
    }
    // item 106
    img.className = "common_button"
    // item 103
    img.style.margin = "5px"
    img.style.cursor = "pointer"
    img.draggable = false
    // item 105
    img.onclick = item.callback
}

function addGridRow(table, row) {
    // item 102
    var tr = make(table, "tr")
    // item 920001
    var _ind92 = 0;
    var _col92 = row;
    var _len92 = _col92.length;
    while (true) {
        // item 920002
        if (_ind92 < _len92) {
            
        } else {
            break;
        }
        // item 920004
        var item = _col92[_ind92];
        // item 94
        addCell(tr, item)
        // item 920003
        _ind92++;
    }
}

function addItem(item) {
    // item 125
    if (gList) {
        // item 112
        addMenuItem(gList, item)
    }
}

function addMenuItem(list, item) {
    // item 76
    if (item.type == "separator") {
        // item 79
        var hr = make(list, "hr")
        hr.style.margin = "0px"
    } else {
        // item 52
        var table = make(list, "table")
        table.style.width = "100%"
        var row = make(table, "tr")
        row.className = "list_item"
        row.style.height = HeaderHeight + "px"
        // item 60
        if (item.image) {
            // item 75
            var td0 = make(row, "td")
            td0.style.width = "33px"
            // item 59
            var img = make(td0, "img")
            img.draggable = false
            img.width = HeaderHeight
            img.height = HeaderHeight
            img.src = makeImagePath(item.image)
            img.style.verticalAlign = "middle"
            img.style.marginLeft = "3px"
        }
        // item 74
        var td1 = make(row, "td")
        td1.style.whiteSpace = "nowrap"
        td1.style.verticalAlign = "middle"
        td1.style.paddingLeft = "5px"
        td1.style.paddingRight = "5px"
        // item 63
        HtmlUtils.setDivText(td1, item.text)
        // item 121
        if (item.text.length > 20) {
            // item 124
            td1.style.fontSize = "80%"
        }
        // item 64
        var callback = function(evt) {
        	var x = evt.clientX
        	var y = evt.clientY
        	hide()
        	item.code(x, y)
        }
        // item 65
        row.onclick = callback
    }
}

function buildWindow(click) {
    // item 34
    var main = HtmlUtils.createPopup(click)
    main.className = "popup"
    main.style.minWidth = "100px"
    main.style.overflow = "hidden"
    main.style.background = "white"
    // item 37
    HtmlUtils.noContext(main)
    // item 35
    var header = make(main, "div")
    header.style.background = DarkBackground
    header.style.height = HeaderHeight + "px"
    // item 36
    var img = make(header, "img")
    img.draggable = false
    img.src = makeImagePath("cross.png")
    img.width = HeaderHeight
    img.height = HeaderHeight
    // item 38
    var style = img.style
    img.className = "common_button"
    style.cursor = "pointer"
    style.display = "inline-block"
    style["float"] = "right"
    // item 41
    img.onclick = hide
    // item 40
    var list = make(main, "div")
    // item 39
    return {
    	main: main,
    	list: list
    }
}

function fillGrid(list, menu) {
    // item 86
    var table = make(list, "table")
    // item 820001
    var _ind82 = 0;
    var _col82 = menu.rows;
    var _len82 = _col82.length;
    while (true) {
        // item 820002
        if (_ind82 < _len82) {
            
        } else {
            break;
        }
        // item 820004
        var item = _col82[_ind82];
        // item 84
        addGridRow(table, item)
        // item 820003
        _ind82++;
    }
}

function fillList(list, menu) {
    // item 180001
    var _ind18 = 0;
    var _col18 = menu.rows;
    var _len18 = _col18.length;
    while (true) {
        // item 180002
        if (_ind18 < _len18) {
            
        } else {
            break;
        }
        // item 180004
        var item = _col18[_ind18];
        // item 20
        addMenuItem(list, item)
        // item 180003
        _ind18++;
    }
}

function hide() {
    // item 119
    gList = null
    gMain = null
    // item 46
    HtmlUtils.hidePopup()
}

function make(parent, tag) {
    // item 71
    var element = document.createElement(tag)
    parent.appendChild(element)
    // item 73
    //element.ontouchstart = prevent
    //element.ontouchmove = prevent
    //element.ontouchend = prevent
    // item 72
    return element
}

function makeImagePath(image) {
    // item 58
    return "/static/images/" + image
}

function repos(x, y) {
    // item 128
    if (gList) {
        // item 120
        gMain.style.height = ""
        gMain.style.width = ""
        // item 118
        HtmlUtils.setPosCorrected(
        	x,
        	y,
        	gMain
        )
    }
}

function show(left, top, menu, click) {
    // item 6
    var win = buildWindow(click)
    gList = win.list
    gMain = win.main
    // item 10
    if (menu.isGrid) {
        // item 26
        fillGrid(win.list, menu)
    } else {
        // item 27
        fillList(win.list, menu)
    }
    // item 28
    HtmlUtils.setPosCorrected(
    	left,
    	top,
    	win.main
    )
    // item 81
    HtmlUtils.setUpMovable(win.main, HeaderHeight)
}


this.show = show
this.hide = hide
this.addItem = addItem
this.repos = repos

}

ContextMenu = new ContextMenuModule(window, document)
