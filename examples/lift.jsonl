{"type":"folder","name":"Graphics","id":"2","parent":"root"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"12"},"3":{"type":"action","one":"4","content":"mainDiv = get(\"main-container\")"},"4":{"type":"action","one":"17","content":"clear(mainDiv)"},"5":{"type":"action","one":"16","content":"canvas = document.createElement(\"canvas\")"},"7":{"type":"action","one":"9","content":"canvas.width = canvasWidth * scale\ncanvas.height = canvasHeight * scale"},"8":{"type":"action","one":"11","content":"add(mainDiv, canvas)\nadd(mainDiv, status)"},"9":{"type":"action","one":"8","content":"canvas.style.width = canvasWidth + \"px\"\ncanvas.style.height = canvasHeight + \"px\""},"10":{"type":"action","one":"7","content":"scale = getRetinaFactor()"},"11":{"type":"action","one":"13","content":"globals.canvas = canvas\nglobals.status = status\nglobals.retina = scale"},"12":{"type":"action","one":"3","content":"canvasHeight = getCanvasHeight()"},"13":{"type":"action","one":"1","content":"canvas.addEventListener(\"click\", onClick)\ncanvas.addEventListener(\n    \"mousemove\",\n    onHover\n)"},"14":{"type":"action","one":"15","content":"status = document.createElement(\"div\")"},"15":{"type":"action","one":"10","content":"status.style.display = \"inline-block\"\nstatus.style.verticalAlign = \"top\""},"16":{"type":"action","one":"14","content":"canvas.style.display = \"inline-block\"\ncanvas.style.verticalAlign = \"top\""},"17":{"type":"action","one":"18","content":"addElementWithText(\n    mainDiv,\n    \"h1\",\n    \"Lift: a state machine demo\"\n)"},"18":{"type":"action","one":"5","content":"addElementWithText(\n    mainDiv,\n    \"p\",\n    \"Press the lift buttons to make it move\"\n)"}},"name":"createCanvas","id":"3","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"4"},"4":{"type":"action","one":"1","content":"drawButton(\n    x,\n    y,\n    buttonSize,\n    buttonSize,\n    text,\n    normalButton,\n    lineColor\n)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"x\ny\ntext","name":"drawActiveButton","id":"4","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"1","content":"drawDown(\n    x,\n    y,\n    buttonSize,\n    buttonSize,\n    normalButton,\n    lineColor\n)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"x\ny","name":"drawActiveDown","id":"5","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"1","content":"drawUp(\n    x,\n    y,\n    buttonSize,\n    buttonSize,\n    normalButton,\n    lineColor\n)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"x\ny","name":"drawActiveUp","id":"6","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"5"},"3":{"type":"action","one":"7","content":"fillRect(x, y, width, height)"},"4":{"type":"action","one":"8","content":"rect(x, y, width, height)"},"5":{"type":"action","one":"6","content":"ctx = globals.ctx"},"6":{"type":"action","one":"3","content":"ctx.fillStyle = background"},"7":{"type":"action","one":"4","content":"ctx.strokeStyle = color"},"8":{"type":"action","one":"9","content":"textWidth = ctx.measureText(text).width"},"9":{"type":"action","one":"10","content":"left = Math.round(\n    x + (width - textWidth) / 2\n)"},"10":{"type":"action","one":"13","content":"bottom = Math.floor(\n    y + height - (\n        height - fontSize * 0.9\n    ) / 2\n)"},"11":{"type":"action","one":"1","content":"ctx.fillText(text, left, bottom)"},"12":{"type":"action","one":"11","content":"ctx.fillStyle = color\nctx.textBaseLine = \"bottom\""},"13":{"type":"action","one":"12","content":"ctx.font = fontSize + \"px \" + fontFace"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"x\ny\nwidth\nheight\ntext\ncolor\nbackground","name":"drawButton","id":"7","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":1,"one":"5","content":"Calculate coords"},"4":{"type":"action","one":"7","content":"left = canvasPadding"},"5":{"type":"action","one":"4","content":"ctx = globals.ctx"},"7":{"type":"action","one":"8","content":"doorLeft = left + (\n    floorWidth - doorWidth\n) / 2"},"8":{"type":"action","one":"9","content":"cabinLeft = doorLeft - cabinThickness"},"9":{"type":"action","one":"10","content":"doorTop = cabinFloorY - doorHeight"},"10":{"type":"action","one":"11","content":"cabinTop = doorTop - cabinThickness"},"11":{"type":"action","one":"27","content":"cabinWidth = doorWidth + cabinThickness *\n2\ncabinHeight = doorHeight + cabinThickness\n* 2"},"14":{"type":"branch","one":"1","branchId":6,"content":"Exit"},"15":{"type":"branch","one":"20","branchId":3,"content":"Left door"},"16":{"type":"branch","branchId":5,"one":"22","content":"Draw cabin"},"17":{"type":"action","one":"32","two":"","content":"fillRect(\n    cabinLeft,\n    cabinTop,\n    cabinWidth,\n    cabinThickness\n)"},"20":{"type":"action","one":"23","content":"leftDoorX = doorLeft - doorWidth * 0.45 *\ndoorOpening"},"22":{"type":"action","one":"17","content":"ctx.fillStyle = lineColor"},"23":{"type":"action","one":"24","two":"","content":"ctx.fillStyle = normalButton"},"24":{"type":"action","one":"25","content":"fillRect(\n    leftDoorX,\n    doorTop,\n    doorWidth / 2,\n    doorHeight\n)"},"25":{"type":"action","one":"26","two":"","content":"ctx.strokeStyle = lineColor"},"26":{"type":"action","one":"37","content":"rect(\n    leftDoorX,\n    doorTop,\n    doorWidth / 2,\n    doorHeight\n)"},"27":{"type":"branch","branchId":2,"one":"30","content":"Draw cabin background"},"29":{"type":"action","one":"15","two":"","content":"fillRect(\n    doorLeft,\n    doorTop,\n    doorWidth,\n    doorHeight\n)"},"30":{"type":"action","one":"29","two":"","content":"ctx.fillStyle = openColor"},"32":{"type":"action","one":"35","two":"","content":"fillRect(\n    cabinLeft,\n    doorTop,\n    cabinThickness,\n    doorHeight\n)"},"35":{"type":"action","one":"36","two":"","content":"fillRect(\n    cabinLeft,\n    cabinFloorY,\n    cabinWidth,\n    cabinThickness\n)"},"36":{"type":"action","one":"14","two":"","content":"fillRect(\n    doorLeft + doorWidth,\n    doorTop,\n    cabinThickness,\n    doorHeight\n)"},"37":{"type":"branch","branchId":4,"one":"38","content":"Right door"},"38":{"type":"action","one":"39","content":"rightDoorX = doorLeft + doorWidth / 2 + doorWidth\n* 0.45 * doorOpening"},"39":{"type":"action","one":"40","content":"fillRect(\n    rightDoorX,\n    doorTop,\n    doorWidth / 2,\n    doorHeight\n)"},"40":{"type":"action","one":"16","content":"rect(\n    rightDoorX,\n    doorTop,\n    doorWidth / 2,\n    doorHeight\n)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"cabinFloorY\ndoorOpening","name":"drawCabin","id":"8","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"5"},"3":{"type":"action","one":"7","content":"fillRect(x, y, width, height)"},"4":{"type":"action","one":"9","content":"rect(x, y, width, height)"},"5":{"type":"action","one":"6","content":"ctx = globals.ctx"},"6":{"type":"action","one":"3","content":"ctx.fillStyle = background"},"7":{"type":"action","one":"4","content":"ctx.strokeStyle = color"},"9":{"type":"action","one":"14","content":"left = Math.round(x + width / 3)"},"12":{"type":"action","one":"17","content":"ctx.fillStyle = color"},"14":{"type":"action","one":"18","content":"right = Math.round(x + width * 2 / 3)"},"15":{"type":"action","one":"16","content":"top = Math.round(y + height / 3)"},"16":{"type":"action","one":"12","content":"bottom = Math.round(y + height * 2 / 3)"},"17":{"type":"action","one":"1","content":"ctx.beginPath();\nctx.moveTo(left, top);\nctx.lineTo(right, top);\nctx.lineTo(middle, bottom);\nctx.fill()"},"18":{"type":"action","one":"15","content":"middle = (left + right) / 2"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"x\ny\nwidth\nheight\ncolor\nbackground","name":"drawDown","id":"9","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"11"},"3":{"type":"action","one":"8","content":"bottom = getFloorBottom(number)"},"5":{"type":"action","one":"6","content":"ctx.strokeStyle = lineColor"},"6":{"type":"action","one":"7","content":"line(\n    left,\n    bottom,\n    left + floorWidth,\n    bottom\n)"},"7":{"type":"action","one":"9","content":"line(\n    left,\n    doorLow,\n    left + floorWidth,\n    doorLow\n)"},"8":{"type":"action","one":"14","content":"doorLow = bottom - floorThickness\ndoorHigh = doorLow + doorHeight"},"9":{"type":"action","one":"13","content":"rect(\n    doorLeft,\n    doorLow - doorHeight,\n    doorWidth,\n    doorHeight\n)"},"10":{"type":"action","one":"5","content":"doorLeft = left + (\n    floorWidth - doorWidth\n) / 2"},"11":{"type":"action","one":"12","content":"ctx = globals.ctx"},"12":{"type":"action","one":"15","content":"left = canvasPadding"},"13":{"type":"action","one":"1","content":"line(\n    middle,\n    doorLow - doorHeight,\n    middle,\n    doorLow\n)"},"14":{"type":"action","one":"10","content":"middle = left + floorWidth / 2"},"15":{"type":"action","one":"3","content":"canvasHeight = getCanvasHeight()"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"number","name":"drawFloor","id":"10","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"7"},"4":{"type":"case","one":"9","content":"\"inner\""},"5":{"type":"case","one":"12","two":"4","content":"\"down\""},"6":{"type":"case","one":"15","two":"5","content":"\"up\""},"7":{"type":"select","one":"6","content":"button.type"},"8":{"type":"action","one":"1","content":"drawNormalButton(\n    button.x,\n    button.y,\n    button.text\n)"},"9":{"type":"question","one":"8","two":"10","flag1":0,"content":"button.machine.on"},"10":{"type":"action","one":"1","content":"drawActiveButton(\n    button.x,\n    button.y,\n    button.text\n)"},"12":{"type":"question","one":"17","two":"18","flag1":0,"content":"button.machine.on"},"14":{"type":"action","one":"1","two":"","content":"drawNormalUp(button.x, button.y)"},"15":{"type":"question","one":"14","two":"16","flag1":0,"content":"button.machine.on"},"16":{"type":"action","one":"1","two":"","content":"drawActiveUp(button.x, button.y)"},"17":{"type":"action","one":"1","two":"","content":"drawNormalDown(button.x, button.y)"},"18":{"type":"action","one":"1","two":"","content":"drawActiveDown(button.x, button.y)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"button","name":"drawGuiButton","id":"11","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"4"},"4":{"type":"action","one":"1","content":"drawButton(\n    x,\n    y,\n    buttonSize,\n    buttonSize,\n    text,\n    lineColor,\n    normalButton\n)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"x\ny\ntext","name":"drawNormalButton","id":"12","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"1","content":"drawDown(\n    x,\n    y,\n    buttonSize,\n    buttonSize,\n    lineColor,\n    normalButton\n)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"x\ny","name":"drawNormalDown","id":"13","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"1","content":"drawUp(\n    x,\n    y,\n    buttonSize,\n    buttonSize,\n    lineColor,\n    normalButton\n)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"x\ny","name":"drawNormalUp","id":"14","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"5"},"3":{"type":"action","one":"7","content":"fillRect(x, y, width, height)"},"4":{"type":"action","one":"9","content":"rect(x, y, width, height)"},"5":{"type":"action","one":"6","content":"ctx = globals.ctx"},"6":{"type":"action","one":"3","content":"ctx.fillStyle = background"},"7":{"type":"action","one":"4","content":"ctx.strokeStyle = color"},"9":{"type":"action","one":"14","content":"left = Math.round(x + width / 3)"},"12":{"type":"action","one":"17","content":"ctx.fillStyle = color"},"14":{"type":"action","one":"18","content":"right = Math.round(x + width * 2 / 3)"},"15":{"type":"action","one":"16","content":"top = Math.round(y + height / 3)"},"16":{"type":"action","one":"12","content":"bottom = Math.round(y + height * 2 / 3)"},"17":{"type":"action","one":"1","content":"ctx.beginPath();\nctx.moveTo(left, bottom);\nctx.lineTo(middle, top);\nctx.lineTo(right, bottom);\nctx.fill()"},"18":{"type":"action","one":"15","content":"middle = (left + right) / 2"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"x\ny\nwidth\nheight\ncolor\nbackground","name":"drawUp","id":"15","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"6"},"5":{"type":"action","one":"1","two":"","content":"ctx.fillRect(x, y, width, height)"},"6":{"type":"action","one":"5","two":"","content":"ctx = globals.ctx"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"x\ny\nwidth\nheight","name":"fillRect","id":"16","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"1","content":"return canvasPadding * 2 + floorCount * floorHeight"}},"name":"getCanvasHeight","id":"17","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"5"},"3":{"type":"action","one":"1","content":"return bottom"},"4":{"type":"action","one":"3","two":"","content":"bottom = canvasHeight - canvasPadding - (\n    number - 1\n) * floorHeight"},"5":{"type":"action","one":"4","two":"","content":"canvasHeight = getCanvasHeight()"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"number","name":"getFloorBottom","id":"18","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"1","content":"return (\n    (\n        window.matchMedia && (\n            window.matchMedia(\n                'only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)'\n            ).matches || window.matchMedia(\n                'only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)'\n            ).matches\n        )\n    ) || (\n        window.devicePixelRatio && window\n        .devicePixelRatio > 1.3\n    )\n)"}},"name":"getRetina","id":"19","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"4"},"3":{"type":"action","one":"1","content":"return window.devicePixelRatio"},"4":{"type":"question","one":"3","two":"5","flag1":1,"content":"window.devicePixelRatio"},"5":{"type":"question","one":"6","two":"7","flag1":1,"content":"isRetina()"},"6":{"type":"action","one":"1","content":"return 2.0"},"7":{"type":"action","one":"1","content":"return 1"}},"name":"getRetinaFactor","id":"20","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"6"},"4":{"type":"action","one":"1","content":"ctx.beginPath();\nctx.moveTo(x1, y1);\nctx.lineTo(x2, y2);\nctx.stroke();"},"5":{"type":"action","one":"4","content":"x1 += 0.5\ny1 += 0.5\nx2 += 0.5\ny2 += 0.5"},"6":{"type":"action","one":"5","content":"ctx = globals.ctx"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"x1\ny1\nx2\ny2","name":"line","id":"21","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"5"},"3":{"type":"action","one":"4","content":"x += 0.5\ny += 0.5"},"4":{"type":"action","one":"1","content":"ctx.strokeRect(x, y, width, height)"},"5":{"type":"action","one":"3","content":"ctx = globals.ctx"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"x\ny\nwidth\nheight","name":"rect","id":"22","parent":"2"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":1,"one":"3","content":"Background"},"3":{"type":"action","one":"32","content":"ctx = globals.canvas.getContext(\"2d\")"},"4":{"type":"action","one":"20","content":"ctx.fillRect(\n    0,\n    0,\n    canvasWidth,\n    canvasHeight\n)"},"5":{"type":"action","one":"11","content":"ctx.fillStyle = background"},"6":{"type":"action","one":"5","content":"globals.ctx = ctx"},"11":{"type":"action","one":"4","content":"canvasHeight = getCanvasHeight()"},"19":{"type":"branch","one":"36","branchId":5,"content":"Exit"},"20":{"type":"branch","one":"22","branchId":2,"content":"Floors"},"21":{"type":"loopend","one":"24","two":"","content":""},"22":{"type":"loopbegin","one":"23","two":"","content":"i = 1; i <= floorCount; i++"},"23":{"type":"action","one":"21","two":"","content":"drawFloor(i)"},"24":{"type":"branch","branchId":3,"one":"30","content":"Cabin"},"25":{"type":"branch","branchId":4,"one":"34","content":"Buttons"},"30":{"type":"action","one":"25","two":"","content":"drawCabin(getCabinPos(), getDoorPos())"},"32":{"type":"action","one":"6","content":"ctx.resetTransform()\nctx.scale(globals.retina, globals.retina)"},"33":{"type":"loopend","one":"19","content":""},"34":{"type":"loopbegin","one":"35","content":"button; globals.buttons"},"35":{"type":"action","one":"33","content":"drawGuiButton(button)"},"36":{"type":"action","one":"1","content":"showMachineStatus()"}},"name":"redraw","id":"23","parent":"2"}
{"type":"folder","name":"Html","id":"24","parent":"root"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"1","content":"parent.appendChild(child)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"parent\nchild","name":"add","id":"25","parent":"24"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"4","content":"element = document.createElement(tag)"},"4":{"type":"action","one":"5","content":"addText(element, text)"},"5":{"type":"action","one":"1","content":"add(container, element)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"container\ntag\ntext","name":"addElementWithText","id":"26","parent":"24"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"1","content":"tnode = document.createTextNode(text);\nelement.appendChild(tnode);"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"element\ntext","name":"addText","id":"27","parent":"24"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"6"},"4":{"type":"question","one":"1","two":"5","flag1":0,"content":"node.firstChild"},"5":{"type":"action","one":"6","content":"node.removeChild(node.lastChild)"},"6":{"type":"arrow-loop","one":"4"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"node","name":"clear","id":"28","parent":"24"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"4","content":"element = document.getElementById(id)"},"4":{"type":"question","one":"5","two":"6","flag1":1,"content":"element"},"5":{"type":"action","one":"1","content":"return element"},"6":{"type":"action","one":"1","content":"throw new Error(\n    \"Element not found \" + id\n)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"id","name":"get","id":"29","parent":"24"}
{"type":"folder","name":"Logic","id":"30","parent":"root"}
{"type":"folder","name":"Commands","id":"31","parent":"30"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"5","content":"globals.cabin.onCommand()"},"5":{"type":"action","one":"1","two":"","content":"resetFloorButtons()"}},"name":"onUserCommand","id":"32","parent":"31"}
{"type":"folder","name":"Events","id":"33","parent":"30"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"4"},"4":{"type":"action","one":"5","two":"","content":"button = findButton(evt)"},"5":{"type":"question","one":"6","two":"10","flag1":1,"content":"button"},"6":{"type":"action","one":"10","two":"","content":"button.machine.click()"},"10":{"type":"action","one":"1","content":"redraw()"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"evt","name":"onClick","id":"34","parent":"33"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"4","content":"button = findButton(evt)"},"4":{"type":"question","one":"5","two":"6","flag1":1,"content":"button"},"5":{"type":"action","one":"1","content":"globals.canvas.style.cursor = \"pointer\""},"6":{"type":"action","one":"1","content":"globals.canvas.style.cursor = \"default\""}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"evt","name":"onHover","id":"35","parent":"33"}
{"type":"folder","name":"Machines","id":"36","parent":"30"}
{"type":"drakon","items":{"2":{"type":"branch","branchId":2,"one":"8","content":"Still"},"5":{"type":"branch","one":"12","branchId":4,"content":"Increasing"},"6":{"type":"branch","branchId":1,"one":"7","content":"Init"},"7":{"type":"action","one":"2","content":"self.current = 0\nself.velocity = 0"},"8":{"type":"sinput","one":"39","content":"start(target)"},"10":{"type":"case","one":"22","two":"43","content":"newTarget(target)"},"11":{"type":"case","one":"14","two":"10","content":"update()"},"12":{"type":"select","one":"11","content":"receive"},"14":{"type":"action","one":"19","content":"scheduleUpdate()"},"18":{"type":"question","one":"5","two":"21","flag1":0,"content":"self.current >= self.target"},"19":{"type":"action","one":"47","content":"self.current += self.velocity * globals.delta"},"21":{"type":"action","one":"33","content":"self.current = self.target\nself.velocity = 0"},"22":{"type":"action","one":"5","content":"self.target = target"},"23":{"type":"branch","one":"26","branchId":5,"content":"Decreasing"},"24":{"type":"case","one":"31","two":"44","content":"newTarget(target)"},"25":{"type":"case","one":"37","two":"24","content":"update()"},"26":{"type":"select","one":"25","content":"receive"},"28":{"type":"question","one":"23","two":"30","flag1":0,"content":"self.current <= self.target"},"30":{"type":"action","one":"34","content":"self.current = self.target\nself.velocity = 0"},"31":{"type":"action","one":"23","content":"self.target = target"},"33":{"type":"soutput","one":"2","content":"onDone()"},"34":{"type":"soutput","one":"2","content":"onDone()"},"37":{"type":"action","one":"48","content":"scheduleUpdate()"},"39":{"type":"branch","branchId":3,"one":"42","content":"Start"},"40":{"type":"question","one":"5","two":"23","flag1":1,"content":"target > self.current"},"41":{"type":"action","one":"40","two":"","content":"self.target = target\nself.startPos = self.current"},"42":{"type":"action","one":"41","two":"","content":"scheduleUpdate()"},"43":{"one":"39","type":"case","two":null,"content":"start(target)"},"44":{"one":"39","type":"case","two":null,"content":"start(target)"},"46":{"type":"action","one":"28","content":"self.velocity = getDecVelocity(\n    self,\n    maxVelocity,\n    accDistance\n)"},"47":{"type":"action","one":"18","content":"self.velocity = getIncVelocity(\n    self,\n    maxVelocity,\n    accDistance\n)"},"48":{"type":"action","one":"46","content":"self.current -= self.velocity * globals.delta"}},"keywords":{"function":false,"machine":true,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"onDone\nmaxVelocity\naccDistance","name":"AcceleratedMotor","id":"37","parent":"36"}
{"type":"drakon","items":{"2":{"type":"branch","branchId":1,"one":"41","content":"ClosedStill"},"5":{"type":"branch","one":"69","branchId":5,"content":"Moving"},"10":{"type":"select","one":"11","content":"receive"},"11":{"type":"case","one":"17","two":"16","content":"update()"},"12":{"type":"case","one":"18","two":null,"content":"onCommand()"},"16":{"one":"25","type":"case","two":"12","content":"onArrived()"},"17":{"type":"action","one":"5","content":"self.motor.update()"},"18":{"type":"action","one":"5","content":"updateDestination(self)"},"25":{"type":"action","one":"74","content":"globals.currentFloor = self.target\nself.target = undefined"},"27":{"type":"branch","branchId":2,"one":"30","content":"Opening"},"28":{"type":"branch","branchId":4,"one":"42","content":"Closing"},"30":{"type":"select","one":"31","content":"receive"},"31":{"type":"case","one":"35","two":"32","content":"update()"},"32":{"type":"case","one":"50","two":null,"content":"onDoor()"},"35":{"type":"action","one":"27","content":"self.door.update()"},"37":{"type":"question","one":"40","two":"70","flag1":0,"content":"requestedCurrentFloor()"},"40":{"type":"question","one":"2","two":"5","flag1":0,"content":"startMovement(self)"},"41":{"type":"sinput","one":"37","content":"onCommand()"},"42":{"type":"select","one":"43","content":"receive"},"43":{"type":"case","one":"45","two":"55","content":"update()"},"44":{"type":"case","one":"46","two":null,"content":"onDoor()"},"45":{"type":"action","one":"28","content":"self.door.update()"},"46":{"type":"question","one":"2","two":"5","flag1":0,"content":"startMovement(self)"},"50":{"type":"branch","branchId":3,"one":"51","content":"Open"},"51":{"type":"action","one":"72","content":"setTimeout(self.onTimeout, doorTimeout)"},"53":{"type":"action","one":"28","content":"closeDoor(self)"},"55":{"one":"60","type":"case","two":"44","content":"onCommand()"},"60":{"type":"question","one":"28","two":"73","flag1":0,"content":"requestedCurrentFloor()"},"69":{"type":"action","one":"10","content":"globals.currentFloor = undefined"},"70":{"type":"action","one":"27","two":"","content":"openDoor(self)"},"71":{"type":"action","one":"27","two":"","content":"openDoor(self)"},"72":{"type":"sinput","one":"53","content":"onTimeout()"},"73":{"type":"action","one":"27","two":"","content":"openDoor(self)"},"74":{"type":"action","one":"71","two":"","content":"resetFloorButtons()"}},"keywords":{"function":false,"machine":true,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"","name":"CabinMachine","id":"38","parent":"36"}
{"type":"folder","name":"Helpers","id":"39","parent":"36"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"1","content":"self.door.start(0)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"self","name":"closeDoor","id":"40","parent":"39"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"5","content":"found = undefined\ncabin = getCabinPos() + accelerationDistance"},"4":{"type":"loopend","one":"14","content":""},"5":{"type":"loopbegin","one":"6","content":"i = 1; i <= floorCount; i++"},"6":{"type":"action","one":"7","content":"floorY = floorToPosition(i)"},"7":{"type":"question","one":"8","two":"14","flag1":1,"content":"floorY >= cabin"},"8":{"type":"question","one":"12","two":"11","flag1":0,"content":"found"},"9":{"type":"action","one":"4","content":"found = i"},"11":{"type":"question","one":"9","two":"15","flag1":1,"content":"isFloorRequestedInner(i)"},"12":{"type":"question","one":"13","two":"4","flag1":1,"content":"isFloorRequested(i)"},"13":{"type":"action","one":"4","content":"found = i"},"14":{"type":"action","one":"1","content":"return found"},"15":{"type":"question","one":"9","two":"4","flag1":1,"content":"isFloorRequestedDown(i)"}},"name":"findNextTargetDown","id":"41","parent":"39"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"5","content":"found = undefined\ncabin = getCabinPos() - accelerationDistance"},"4":{"type":"loopend","one":"14","content":""},"5":{"type":"loopbegin","one":"6","content":"i = floorCount; i > 0; i--"},"6":{"type":"action","one":"7","content":"floorY = floorToPosition(i)"},"7":{"type":"question","one":"8","two":"14","flag1":1,"content":"floorY <= cabin"},"8":{"type":"question","one":"12","two":"11","flag1":0,"content":"found"},"9":{"type":"action","one":"4","content":"found = i"},"11":{"type":"question","one":"9","two":"15","flag1":1,"content":"isFloorRequestedInner(i)"},"12":{"type":"question","one":"13","two":"4","flag1":1,"content":"isFloorRequested(i)"},"13":{"type":"action","one":"4","content":"found = i"},"14":{"type":"action","one":"1","content":"return found"},"15":{"type":"question","one":"9","two":"4","flag1":1,"content":"isFloorRequestedUp(i)"}},"name":"findNextTargetUp","id":"42","parent":"39"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"22"},"16":{"type":"question","one":"20","two":"17","flag1":1,"content":"self.current > m1"},"17":{"type":"question","one":"24","two":"19","flag1":1,"content":"self.current < m2"},"18":{"type":"action","one":"1","two":"","content":"return Math.max(\n    maxVelocity * 0.05,\n    Math.min(result, maxVelocity)\n)"},"19":{"type":"action","one":"18","two":"","content":"result = maxVelocity"},"20":{"type":"action","one":"18","two":"","content":"result = self.velocity + acc * globals.delta"},"22":{"type":"action","one":"23","two":"","content":"accTime = 2 * accDistance / maxVelocity"},"23":{"type":"action","one":"25","two":"","content":"acc = maxVelocity / accTime"},"24":{"type":"action","one":"18","two":"","content":"result = self.velocity - acc * globals.delta"},"25":{"type":"action","one":"26","two":"","content":"m1 = self.startPos - accDistance"},"26":{"type":"action","one":"16","two":"","content":"m2 = self.target + accDistance"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"self\nmaxVelocity\naccDistance","name":"getDecVelocity","id":"43","parent":"39"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"14"},"3":{"type":"action","one":"4","content":"m1 = self.startPos + accDistance"},"4":{"type":"action","one":"7","content":"m2 = self.target - accDistance"},"7":{"type":"question","one":"11","two":"8","flag1":1,"content":"self.current < m1"},"8":{"type":"question","one":"16","two":"10","flag1":1,"content":"self.current > m2"},"9":{"type":"action","one":"1","content":"return Math.max(\n    maxVelocity * 0.05,\n    Math.min(result, maxVelocity)\n)"},"10":{"type":"action","one":"9","content":"result = maxVelocity"},"11":{"type":"action","one":"9","content":"result = self.velocity + acc * globals.delta"},"14":{"type":"action","one":"15","content":"accTime = 2 * accDistance / maxVelocity"},"15":{"type":"action","one":"3","content":"acc = maxVelocity / accTime"},"16":{"type":"action","one":"9","content":"result = self.velocity - acc * globals.delta"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"self\nmaxVelocity\naccDistance","name":"getIncVelocity","id":"44","parent":"39"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"13"},"3":{"type":"action","one":"4","content":"m1 = self.startPos + accDistance"},"4":{"type":"action","one":"7","content":"m2 = self.target - accDistance"},"6":{"type":"action","one":"3","content":"distance = self.target - self.startPos"},"7":{"type":"question","one":"11","two":"8","flag1":1,"content":"self.current < m1"},"8":{"type":"question","one":"12","two":"10","flag1":1,"content":"self.current > m2"},"9":{"type":"action","one":"1","content":"return result"},"10":{"type":"action","one":"9","content":"result = maxVelocity"},"11":{"type":"action","one":"9","content":"result = (\n    self.current - self.startPos + cutoff\n) / (accDistance + cutoff) * maxVelocity"},"12":{"type":"action","one":"9","content":"result = (\n    self.target - self.current + cutoff\n) / (accDistance + cutoff) * maxVelocity"},"13":{"type":"action","one":"6","content":"cutoff = accDistance * 0.1"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"self\nmaxVelocity\naccDistance","name":"getIncVelocityOld","id":"45","parent":"39"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"4"},"3":{"type":"action","one":"1","content":"return true"},"4":{"type":"question","one":"3","two":"5","flag1":1,"content":"isFloorRequestedUp(number)"},"5":{"type":"question","one":"3","two":"6","flag1":1,"content":"isFloorRequestedDown(number)"},"6":{"type":"question","one":"3","two":"7","flag1":1,"content":"isFloorRequestedInner(number)"},"7":{"type":"action","one":"1","content":"return false"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"number","name":"isFloorRequested","id":"46","parent":"39"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"5","content":"floor = globals.floors[number]"},"4":{"type":"action","one":"1","content":"return floor.down.machine.on"},"5":{"type":"question","one":"4","two":"6","flag1":1,"content":"floor.down"},"6":{"type":"action","one":"1","content":"return false"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"number","name":"isFloorRequestedDown","id":"47","parent":"39"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"4","content":"floor = globals.floors[number]"},"4":{"type":"action","one":"1","content":"return floor.inner.machine.on"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"number","name":"isFloorRequestedInner","id":"48","parent":"39"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"5","content":"floor = globals.floors[number]"},"4":{"type":"action","one":"1","content":"return floor.up.machine.on"},"5":{"type":"question","one":"4","two":"6","flag1":1,"content":"floor.up"},"6":{"type":"action","one":"1","content":"return false"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"number","name":"isFloorRequestedUp","id":"49","parent":"39"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"1","content":"self.door.start(1)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"self","name":"openDoor","id":"50","parent":"39"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"4"},"4":{"type":"question","one":"6","two":"9","flag1":1,"content":"globals.currentFloor"},"5":{"type":"loopend","one":"9","content":""},"6":{"type":"loopbegin","one":"7","content":"i = 1; i <= floorCount; i++"},"7":{"type":"question","one":"5","two":"8","flag1":0,"content":"isFloorRequested(globals.currentFloor)"},"8":{"type":"action","one":"5","content":"return true"},"9":{"type":"action","one":"1","content":"return false"}},"name":"requestedCurrentFloor","id":"51","parent":"39"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"9"},"3":{"type":"action","one":"4","content":"floor = globals.floors[\n    globals.currentFloor\n]"},"4":{"type":"question","one":"5","two":"6","flag1":1,"content":"floor.up"},"5":{"type":"action","one":"6","content":"floor.up.machine.reset()"},"6":{"type":"question","one":"7","two":"8","flag1":1,"content":"floor.down"},"7":{"type":"action","one":"8","two":"","content":"floor.down.machine.reset()"},"8":{"type":"action","one":"1","content":"floor.inner.machine.reset()"},"9":{"type":"question","one":"3","two":"1","flag1":1,"content":"globals.currentFloor"}},"name":"resetFloorButtons","id":"52","parent":"39"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"4"},"3":{"type":"action","one":"20","content":"self.target = nextTarget"},"4":{"type":"question","one":"11","two":"14","flag1":1,"content":"self.direction === \"up\""},"11":{"type":"action","one":"12","content":"nextTarget = findNextTargetUp()"},"12":{"type":"question","one":"29","two":"13","flag1":1,"content":"nextTarget"},"13":{"type":"action","one":"17","content":"nextTarget = findNextTargetDown()"},"14":{"type":"action","one":"15","content":"nextTarget = findNextTargetDown()"},"15":{"type":"question","one":"27","two":"16","flag1":1,"content":"nextTarget"},"16":{"type":"action","one":"19","content":"nextTarget = findNextTargetUp()"},"17":{"type":"action","one":"3","content":"self.direction = \"down\""},"19":{"type":"action","one":"3","content":"self.direction = \"up\""},"20":{"type":"question","one":"24","two":"26","flag1":1,"content":"self.target"},"21":{"type":"action","one":"1","content":"return true"},"22":{"type":"action","one":"1","content":"return false"},"23":{"type":"action","one":"21","content":"self.motor.start(targetY)"},"24":{"type":"action","one":"23","content":"targetY = floorToPosition(self.target)"},"26":{"type":"action","one":"22","content":"self.direction = undefined"},"27":{"type":"action","one":"3","content":"self.direction = \"down\""},"29":{"type":"action","one":"3","content":"self.direction = \"up\""}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"self","name":"startMovement","id":"53","parent":"39"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":1,"one":"4","content":"Check"},"4":{"type":"question","one":"5","two":"8","flag1":1,"content":"self.direction === \"up\""},"5":{"type":"action","one":"6","two":"","content":"nextTarget = findNextTargetUp()"},"6":{"type":"question","one":"15","two":"21","flag1":1,"content":"nextTarget"},"8":{"type":"action","one":"9","two":"","content":"nextTarget = findNextTargetDown()"},"9":{"type":"question","one":"17","two":"21","flag1":1,"content":"nextTarget"},"15":{"type":"question","one":"22","two":"21","flag1":1,"content":"nextTarget < self.target"},"17":{"type":"question","one":"22","two":"21","flag1":1,"content":"nextTarget > self.target"},"21":{"type":"branch","one":"1","branchId":3,"content":"Exit"},"22":{"type":"branch","one":"23","branchId":2,"content":"Set new target"},"23":{"type":"action","one":"25","two":"","content":"self.target = nextTarget"},"24":{"type":"action","one":"21","two":"","content":"self.motor.newTarget(targetY)"},"25":{"type":"action","one":"24","two":"","content":"targetY = floorToPosition(self.target)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"self","name":"updateDestination","id":"54","parent":"39"}
{"type":"drakon","items":{"2":{"type":"branch","branchId":2,"one":"8","content":"Still"},"5":{"type":"branch","one":"12","branchId":4,"content":"Increasing"},"6":{"type":"branch","branchId":1,"one":"7","content":"Init"},"7":{"type":"action","one":"2","content":"self.current = 0"},"8":{"type":"sinput","one":"39","content":"start(target)"},"10":{"type":"case","one":"22","two":"43","content":"newTarget(target)"},"11":{"type":"case","one":"14","two":"10","content":"update()"},"12":{"type":"select","one":"11","content":"receive"},"14":{"type":"action","one":"19","content":"scheduleUpdate()"},"18":{"type":"question","one":"5","two":"21","flag1":0,"content":"self.current >= self.target"},"19":{"type":"action","one":"18","content":"self.current += velocity * globals.delta"},"21":{"type":"action","one":"33","content":"self.current = self.target"},"22":{"type":"action","one":"5","content":"self.target = target"},"23":{"type":"branch","one":"26","branchId":5,"content":"Decreasing"},"24":{"type":"case","one":"31","two":"44","content":"newTarget(target)"},"25":{"type":"case","one":"37","two":"24","content":"update()"},"26":{"type":"select","one":"25","content":"receive"},"28":{"type":"question","one":"23","two":"30","flag1":0,"content":"self.current <= self.target"},"29":{"type":"action","one":"28","content":"self.current -= velocity * globals.delta"},"30":{"type":"action","one":"34","content":"self.current = self.target"},"31":{"type":"action","one":"23","content":"self.target = target"},"33":{"type":"soutput","one":"2","content":"onDone()"},"34":{"type":"soutput","one":"2","content":"onDone()"},"37":{"type":"action","one":"29","content":"scheduleUpdate()"},"39":{"type":"branch","branchId":3,"one":"42","content":"Start"},"40":{"type":"question","one":"5","two":"23","flag1":1,"content":"target > self.current"},"41":{"type":"action","one":"40","two":"","content":"self.target = target"},"42":{"type":"action","one":"41","two":"","content":"scheduleUpdate()"},"43":{"one":"39","type":"case","two":null,"content":"start(target)"},"44":{"one":"39","type":"case","two":null,"content":"start(target)"}},"keywords":{"function":false,"machine":true,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"onDone\nvelocity","name":"LinearMotor","id":"55","parent":"36"}
{"type":"drakon","items":{"2":{"type":"branch","branchId":1,"one":"3","content":"Off"},"3":{"type":"action","one":"6","content":"self.on = false"},"5":{"type":"branch","one":"7","branchId":2,"content":"On"},"6":{"type":"sinput","one":"12","content":"click()"},"7":{"type":"action","one":"8","content":"self.on = true"},"8":{"type":"sinput","one":"14","content":"reset()"},"12":{"type":"soutput","one":"13","content":"onUserCommand()"},"13":{"type":"action","one":"5","content":"scheduleUpdate()"},"14":{"type":"action","one":"2","content":"scheduleUpdate()"}},"keywords":{"function":false,"machine":true,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"","name":"OneWayButton","id":"56","parent":"36"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"4","content":"globals.floors = [undefined]\nglobals.delta = 0\nglobals.buttons = []"},"4":{"type":"action","one":"5","content":"createFloor(1, true, false)"},"5":{"type":"action","one":"6","content":"createFloor(2, true, true)"},"6":{"type":"action","one":"8","content":"createFloor(3, true, true)"},"8":{"type":"action","one":"9","content":"createFloor(4, false, true)"},"9":{"type":"action","one":"11","content":"globals.currentFloor = 1"},"10":{"type":"action","one":"1","content":"takeCabinPositionFromFloor()"},"11":{"type":"action","one":"12","content":"cabin = CabinMachine()"},"12":{"type":"action","one":"13","content":"cabin.door = LinearMotor(\n    cabin.onDoor,\n    doorVelocity\n)\ncabin.motor = AcceleratedMotor(\n    cabin.onArrived,\n    cabinVelocity,\n    accelerationDistance\n)"},"13":{"type":"action","one":"10","content":"globals.cabin = cabin"}},"name":"buildStructures","id":"57","parent":"30"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"4","content":"button = {\n    x: x,\n    y: y,\n    type: type,\n    text: text,\n    machine: OneWayButton()\n}"},"4":{"type":"action","one":"5","content":"globals.buttons.push(button)"},"5":{"type":"action","one":"1","content":"return button"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"type\ntext\nx\ny","name":"createButton","id":"58","parent":"30"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":2,"one":"4","content":"Floor button"},"4":{"type":"question","one":"5","two":"17","flag1":1,"content":"up"},"5":{"type":"question","one":"9","two":"27","flag1":1,"content":"down"},"9":{"type":"action","one":"10","content":"y1 = centerY - (\n    buttonSize + buttonMargin / 2\n)"},"10":{"type":"action","one":"11","content":"y2 = y1 + buttonSize + buttonMargin"},"11":{"type":"action","one":"12","content":"floor.up = createButton(\n    \"up\",\n    undefined,\n    left,\n    y1\n)"},"12":{"type":"action","one":"19","content":"floor.down = createButton(\n    \"down\",\n    undefined,\n    left,\n    y2\n)"},"14":{"type":"action","one":"19","content":"floor.up = createButton(\n    \"up\",\n    undefined,\n    left,\n    y\n)"},"16":{"type":"action","one":"19","two":"","content":"floor.down = createButton(\n    \"down\",\n    undefined,\n    left,\n    y\n)"},"17":{"type":"question","one":"28","two":"19","flag1":1,"content":"down"},"18":{"type":"branch","one":"24","branchId":4,"content":"Exit"},"19":{"type":"branch","one":"35","branchId":3,"content":"Cabin button"},"20":{"type":"action","one":"29","content":"nleft = left + buttonSize + canvasPadding\n* 2"},"22":{"type":"action","one":"18","two":"","content":"floor.inner = createButton(\n    \"inner\",\n    number,\n    nleft,\n    y\n)"},"24":{"type":"action","one":"1","content":"globals.floors.push(floor)"},"27":{"type":"action","one":"14","content":"y = centerY - buttonSize / 2"},"28":{"type":"action","one":"16","content":"y = centerY - buttonSize / 2"},"29":{"type":"action","one":"22","content":"y = innerBottom - canvasPadding - floorThickness\n- buttonSize - (number - 1) * (\n    buttonSize + buttonMargin\n)"},"30":{"type":"branch","branchId":1,"one":"34","content":"Common values"},"31":{"type":"action","one":"33","two":"","content":"centerY = Math.round(\n    bottom - floorHeight / 2\n)"},"32":{"type":"action","one":"31","two":"","content":"bottom = getFloorBottom(number)"},"33":{"type":"action","one":"2","two":"","content":"left = canvasPadding + floorWidth + canvasPadding"},"34":{"type":"action","one":"32","two":"","content":"floor = {number: number}"},"35":{"type":"action","one":"20","two":"","content":"innerBottom = getFloorBottom(1)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"number\nup\ndown","name":"createFloor","id":"59","parent":"30"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"8"},"3":{"type":"action","one":"1","content":"return undefined"},"4":{"type":"loopend","one":"3","content":""},"5":{"type":"loopbegin","one":"6","content":"button; globals.buttons"},"6":{"type":"question","one":"4","two":"7","flag1":0,"content":"hitBox(\n    button.x,\n    button.y,\n    buttonSize,\n    buttonSize,\n    x,\n    y\n)"},"7":{"type":"action","one":"4","content":"return button"},"8":{"type":"action","one":"9","content":"crect = globals.canvas.getBoundingClientRect()"},"9":{"type":"action","one":"5","content":"x = evt.clientX - crect.left\ny = evt.clientY - crect.top"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"evt","name":"findButton","id":"60","parent":"30"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"5"},"4":{"type":"action","one":"1","two":"","content":"return canvasHeight - canvasPadding - (\n    number - 1\n) * floorHeight - floorThickness"},"5":{"type":"action","one":"4","two":"","content":"canvasHeight = getCanvasHeight()"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"number","name":"floorToPosition","id":"61","parent":"30"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"1","content":"return globals.cabin.motor.current"}},"name":"getCabinPos","id":"62","parent":"30"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"1","content":"return globals.cabin.door.current"}},"name":"getDoorPos","id":"63","parent":"30"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"4"},"3":{"type":"action","one":"6","content":"right = left + width"},"4":{"type":"question","one":"5","two":"10","flag1":1,"content":"x >= left"},"5":{"type":"question","one":"3","two":"10","flag1":1,"content":"y >= top"},"6":{"type":"question","one":"7","two":"10","flag1":1,"content":"x < right"},"7":{"type":"action","one":"8","content":"bottom = top + height"},"8":{"type":"question","one":"9","two":"10","flag1":1,"content":"y < bottom"},"9":{"type":"action","one":"1","content":"return true"},"10":{"type":"action","one":"1","content":"return false"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"left\ntop\nwidth\nheight\nx\ny","name":"hitBox","id":"64","parent":"30"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"5"},"4":{"type":"action","one":"1","content":"requestAnimationFrame(updateWorld)"},"5":{"type":"action","one":"4","content":"globals.updateScheduled = true"}},"name":"scheduleUpdate","id":"65","parent":"30"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"4","content":"globals.cabin.motor.current = floorToPosition(\n    globals.currentFloor\n)"},"4":{"type":"action","one":"1","content":"globals.cabin.door.current = 0"}},"name":"takeCabinPositionFromFloor","id":"66","parent":"30"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"5"},"4":{"type":"question","one":"7","two":"8","flag1":1,"content":"globals.lastFrame"},"5":{"type":"action","one":"4","two":"","content":"now = new Date().getTime()"},"6":{"type":"action","one":"1","two":"","content":"globals.lastFrame = now"},"7":{"type":"action","one":"6","two":"","content":"globals.delta = Math.min(\n    0.2,\n    (now - globals.lastFrame) / 1000\n)"},"8":{"type":"action","one":"6","two":"","content":"globals.delta = 0"}},"name":"updateFrameTime","id":"67","parent":"30"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"10","content":"updateFrameTime()"},"6":{"type":"action","one":"11","content":"redraw()"},"10":{"type":"action","one":"6","content":"globals.cabin.update()"},"11":{"type":"question","one":"12","two":"13","flag1":1,"content":"globals.updateScheduled"},"12":{"type":"action","one":"1","content":"globals.updateScheduled = false"},"13":{"type":"action","one":"1","content":"globals.lastFrame = 0"}},"name":"updateWorld","id":"68","parent":"30"}
{"type":"folder","name":"Visualization","id":"69","parent":"root"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"5","content":"objLine = document.createElement(\"div\")"},"4":{"type":"action","one":"1","content":"add(container, objLine)"},"5":{"type":"action","one":"6","content":"objLine.style.margin = \"5px\""},"6":{"type":"question","one":"7","two":"8","flag1":1,"content":"depth"},"7":{"type":"action","one":"8","content":"indent = document.createElement(\"span\")\nindent.style.display = \"inline-block\"\nindent.style.verticalAlign = \"middle\"\nindent.style.width = 20 * depth + \"px\"\nadd(objLine, indent)"},"8":{"type":"action","one":"15","content":"nameEl = document.createElement(\"span\")\nnameEl.style.display = \"inline-block\"\nnameEl.style.verticalAlign = \"middle\"\naddText(nameEl, name + \": \")\nnameEl.style.minWidth = \"100px\"\nadd(objLine, nameEl)"},"9":{"type":"action","one":"17","content":"valueEl = document.createElement(\"span\")\nvalueEl.style.display = \"inline-block\"\nvalueEl.style.verticalAlign = \"middle\"\naddText(valueEl, valueStr)\nadd(objLine, valueEl)"},"11":{"type":"action","one":"9","content":"valueStr = formatValue(value)"},"14":{"type":"question","one":"11","two":"4","flag1":0,"content":"value === undefined"},"15":{"type":"question","one":"14","two":"16","flag1":0,"content":"bold"},"16":{"type":"action","one":"14","two":"","content":"nameEl.style.fontWeight = \"bold\""},"17":{"type":"action","one":"4","content":"valueEl.style.fontWeight = \"bold\""}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"depth\ncontainer\nname\nvalue\nbold","name":"addLine","id":"70","parent":"69"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"4"},"4":{"type":"question","one":"5","two":"8","flag1":1,"content":" typeof value === \"number\""},"5":{"type":"question","one":"6","two":"7","flag1":1,"content":"value === Math.round(value)"},"6":{"type":"action","one":"1","content":"return value.toString()"},"7":{"type":"action","one":"1","content":"return value.toFixed(2).toString()"},"8":{"type":"action","one":"1","content":"return value.toString()"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"value","name":"formatValue","id":"71","parent":"69"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"12"},"3":{"type":"action","one":"5","content":"addLine(\n    depth,\n    container,\n    \"state\",\n    machine.state,\n    true\n)"},"4":{"type":"question","one":"3","two":"1","flag1":1,"content":"machine.state"},"5":{"type":"action","one":"6","content":"names = Object.keys(machine)"},"6":{"type":"action","one":"8","content":"names.sort()"},"7":{"type":"loopend","one":"1","content":""},"8":{"type":"loopbegin","one":"10","content":"name; names"},"10":{"type":"question","one":"14","two":"7","flag1":0,"content":"name === \"state\""},"12":{"type":"question","one":"4","two":"1","flag1":1,"content":"machine"},"14":{"type":"action","one":"18","content":"value = machine[name]"},"15":{"type":"case","one":"19"},"16":{"type":"case","one":"7","two":"15","content":"\"function\""},"17":{"type":"case","one":"21","two":"16","content":"\"object\""},"18":{"type":"select","one":"17","content":" typeof value"},"19":{"type":"action","one":"7","content":"addLine(\n    depth,\n    container,\n    name,\n    value,\n    false\n)"},"20":{"type":"action","one":"7","content":"printMachine(container, value, depth + 1)"},"21":{"type":"action","one":"20","content":"addLine(\n    depth,\n    container,\n    name,\n    undefined,\n    false\n)"}},"keywords":{"function":true,"machine":false,"async":false,"export":false,"algoprop":false,"lazy":false},"params":"container\nmachine\ndepth","name":"printMachine","id":"72","parent":"69"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"4","content":"status = globals.status"},"4":{"type":"action","one":"7","content":"clear(status)"},"6":{"type":"action","one":"1","content":"printMachine(status, root, 0)"},"7":{"type":"action","one":"6","content":"root = {\n    cabin: globals.cabin,\n    currentFloor: globals.currentFloor,\n    state: \"ok\"\n}"}},"name":"showMachineStatus","id":"73","parent":"69"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"3"},"3":{"type":"action","one":"5","content":"createCanvas()"},"4":{"type":"action","one":"1","content":"updateWorld()"},"5":{"type":"action","one":"4","content":"buildStructures()"}},"name":"main","id":"74","parent":"root"}
{"type":"drakon","items":{"1":{"type":"end"},"2":{"type":"branch","branchId":0,"one":"4"},"3":{"type":"action","one":"1","content":"window.addEventListener(\"load\", main)"},"4":{"type":"action","one":"7","content":"const canvasWidth = 380\nconst canvasPadding = 30"},"5":{"type":"action","one":"3","content":"globals = {\n    floors: undefined,\n    delta: undefined,\n    buttons: undefined,\n    canvas: undefined,\n    ctx: undefined,\n    target: undefined,\n    currentFloor: undefined,\n    cabin: undefined\n}"},"7":{"type":"action","one":"8","content":"const doorWidth = 80\nconst doorHeight = 130\nconst floorThickness = 20\nconst floorWidth = 160\nconst floorHeight = 180\nconst cabinThickness = 10"},"8":{"type":"action","one":"12","content":"const floorCount = 4"},"9":{"type":"action","one":"10","content":"const fontFace = \"Arial\"\nconst fontSize = 17\nconst buttonSize = 40\nconst buttonMargin = 10"},"10":{"type":"action","one":"11","content":"const activeButton = \"yellow\"\nconst normalButton = \"#f0f0f0\""},"11":{"type":"action","one":"5","content":"const background = \"white\"\nconst lineColor = \"black\"\nconst openColor = \"#8a98d1\""},"12":{"type":"action","one":"9","content":"const accelerationDistance = 60\nconst cabinVelocity = 100\nconst doorVelocity = 1\nconst doorTimeout = 1000"}},"name":"module","id":"75","parent":"root"}